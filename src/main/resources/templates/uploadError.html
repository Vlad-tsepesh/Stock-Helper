<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload Folder - Modern Design</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f4f9;
      color: #333;
      padding: 30px;
    }

    h1 {
      font-weight: 600;
      margin-bottom: 10px;
    }

    #info {
      font-size: 14px;
      color: #555;
      margin-bottom: 15px;
    }

    #error, #warning {
      margin-top: 10px;
      font-weight: bold;
    }

    #error { color: #d9534f; }
    #warning { color: #f0ad4e; }

    #fileList {
      margin-top: 15px;
    }

    .file-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 10px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .remove-btn {
      color: #d9534f;
      cursor: pointer;
      font-weight: bold;
    }

    button, #selectFilesBtn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 18px;
      font-size: 14px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 15px;
      transition: background 0.2s;
    }

    button:hover:not(:disabled), #selectFilesBtn:hover {
      background: #0056b3;
    }

    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    input[type="file"] { display: none; }

    /* Capacity bar */
    #capacityContainer {
      width: 100%;
      background: #e0e0e0;
      height: 25px;
      margin-top: 10px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    #capacityGreen, #capacityRed {
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      text-align: center;
      line-height: 25px;
      font-size: 12px;
      font-weight: 500;
      padding: 0 5px;
      box-sizing: border-box;
      transition: width 0.2s;
    }

    #capacityGreen { background: #28a745; color: white; z-index: 1; width: 0; border-radius: 12px 0 0 12px; }
    #capacityRed { background: #d9534f; color: white; z-index: 2; width: 0; border-radius: 0 12px 12px 0; }

  </style>
</head>
<body>

<h1>Upload Your JPG Files</h1>
<p id="info">Maximum file size per file: <span id="maxFileSizeDisplay"></span> MB. Total capacity per upload: 150 MB.</p>

<div id="capacityContainer">
  <div id="capacityGreen">0 MB</div>
  <div id="capacityRed"></div>
</div>
<p id="warning"></p>

<button type="button" id="selectFilesBtn">Select Files</button>
<input type="file" id="fileInput" multiple accept=".jpg,.jpeg,image/jpeg">

<form id="uploadForm" method="post" enctype="multipart/form-data" action="/upload">
  <div id="fileList"></div>
  <button id="submitBtn" type="submit">Upload and Download ZIP</button>
</form>

<p id="error"></p>

<script>
  const MAX_FILE_SIZE_MB = 10;
  const TOTAL_SIZE_LIMIT_MB = 150;
  const MAX_FILE_SIZE = MAX_FILE_SIZE_MB * 1024 * 1024;
  const TOTAL_SIZE_LIMIT = TOTAL_SIZE_LIMIT_MB * 1024 * 1024;

  const fileInput = document.getElementById('fileInput');
  const selectFilesBtn = document.getElementById('selectFilesBtn');
  const fileListDiv = document.getElementById('fileList');
  const error = document.getElementById('error');
  const warning = document.getElementById('warning');
  const capacityGreen = document.getElementById('capacityGreen');
  const capacityRed = document.getElementById('capacityRed');
  const uploadForm = document.getElementById('uploadForm');
  const submitBtn = document.getElementById('submitBtn');

  let selectedFiles = [];
  document.getElementById('maxFileSizeDisplay').textContent = MAX_FILE_SIZE_MB;

  selectFilesBtn.addEventListener('click', () => fileInput.click());

  function updateFileList() {
      fileListDiv.innerHTML = '';
      let totalSize = 0;
      selectedFiles.forEach((file, index) => {
          totalSize += file.size;
          const div = document.createElement('div');
          div.className = 'file-item';
          div.textContent = `${file.name} (${(file.size / (1024*1024)).toFixed(2)} MB)`;
          const removeBtn = document.createElement('span');
          removeBtn.className = 'remove-btn';
          removeBtn.textContent = '[Remove]';
          removeBtn.addEventListener('click', () => {
              selectedFiles.splice(index, 1);
              updateFileList();
          });
          div.appendChild(removeBtn);
          fileListDiv.appendChild(div);
      });

      const remainingMB = (TOTAL_SIZE_LIMIT - totalSize) / (1024*1024);
      capacityGreen.style.width = Math.min(totalSize / TOTAL_SIZE_LIMIT * 100, 100) + '%';
      capacityGreen.textContent = Math.min(totalSize, TOTAL_SIZE_LIMIT) / (1024*1024).toFixed(2) + ' MB';

      const overage = totalSize - TOTAL_SIZE_LIMIT;
      if(overage > 0){
          capacityRed.style.width = Math.min(overage / TOTAL_SIZE_LIMIT * 100, 100) + '%';
          capacityRed.textContent = overage / (1024*1024).toFixed(2) + ' MB';
      } else {
          capacityRed.style.width = '0';
          capacityRed.textContent = '';
      }

      if(totalSize > TOTAL_SIZE_LIMIT){
          warning.textContent = `Warning: total size exceeded by ${(overage / (1024*1024)).toFixed(2)} MB!`;
          submitBtn.disabled = true;
      } else {
          warning.textContent = '';
          submitBtn.disabled = false;
      }
  }

  fileInput.addEventListener('change', () => {
      const files = Array.from(fileInput.files);
      error.textContent = '';
      for(const file of files){
          const fileType = file.type.toLowerCase();
          if(!fileType.includes('jpeg') && !fileType.includes('jpg')){
              error.textContent = `File "${file.name}" is not a JPG image.`;
              continue;
          }
          if(file.size > MAX_FILE_SIZE){
              error.textContent = `File "${file.name}" exceeds ${MAX_FILE_SIZE_MB} MB.`;
              continue;
          }
          selectedFiles.push(file);
      }
      fileInput.value = '';
      updateFileList();
  });

  uploadForm.addEventListener('submit', (e) => {
      if(selectedFiles.length === 0){
          e.preventDefault();
          error.textContent = 'Please add at least one file.';
          return;
      }
      const formData = new FormData();
      selectedFiles.forEach(f => formData.append('images', f));
      e.preventDefault();
      fetch(uploadForm.action, { method: 'POST', body: formData })
          .then(res => res.ok ? alert('Upload successful!') : alert('Upload failed.'))
          .catch(err => alert('Upload error: ' + err));
  });
</script>
</body>
</html>
